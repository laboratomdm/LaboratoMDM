<Window x:Class="LaboratoMDM.UI.Operator.Views.PolicyBrowserWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System.Windows;assembly=PresentationFramework"
        xmlns:views="clr-namespace:LaboratoMDM.UI.Operator.Views"
        xmlns:viewmodels="clr-namespace:LaboratoMDM.UI.Operator.ViewModels"
        mc:Ignorable="d"
        Title="Policy Browser"
        Width="1200"
        Height="700"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <SolidColorBrush x:Key="PanelBackground" Color="#FFF8F8F8"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#FFD0D0D0"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#FF0078D7"/>

        <!-- TreeView -->
        <Style TargetType="TreeView">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style TargetType="TreeViewItem">
            <Setter Property="IsExpanded" Value="{Binding IsExpanded}"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="Visibility"
                    Value="{Binding IsVisible,
                    Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Style>

        <!-- ListView -->
        <Style TargetType="ListView">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
        </Style>

        <Style TargetType="GridViewColumnHeader">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>

        <!-- Search box -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
        </Style>

        <!-- Group headers -->
        <Style x:Key="PanelHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="8"/>
        </Style>

    </Window.Resources>

    <DockPanel Background="{StaticResource PanelBackground}">

        <!-- Top Search Bar        -->
        <Border DockPanel.Dock="Top"
                Background="White"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <TextBox Style="{StaticResource SearchBoxStyle}"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />
        </Border>

        <!-- Main Content          -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="360"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Categories Tree      -->
            <Border Grid.Column="0"
                    Background="White"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,1,0">

                <DockPanel>
                    <TextBlock DockPanel.Dock="Top"
                               Text="Категории"
                               Style="{StaticResource PanelHeaderStyle}"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <TreeView ItemsSource="{Binding RootCategories}"
                                  SelectedItemChanged="OnCategorySelected">
                            <TreeView.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                    <TextBlock Text="{Binding DisplayName}" />
                                </HierarchicalDataTemplate>
                            </TreeView.ItemTemplate>
                        </TreeView>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- Policies List        -->
            <Border Grid.Column="2"
                    Background="White"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,1,0">

                <DockPanel>
                    <TextBlock DockPanel.Dock="Top"
                               Text="Политики"
                               Style="{StaticResource PanelHeaderStyle}"/>

                    <ListView ItemsSource="{Binding VisiblePolicies}"
                              SelectedItem="{Binding SelectedPolicy}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Имя" Width="260">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding ShowName}"
                                                       TextWrapping="Wrap"
                                                       VerticalAlignment="Center"/>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="Scope"
                                                Width="80"
                                                DisplayMemberBinding="{Binding Scope}" />
                            </GridView>
                        </ListView.View>
                    </ListView>
                </DockPanel>
            </Border>

            <!-- Policy Editor        -->
            <Border Grid.Column="4"
        Background="White">
                <TabControl>

                    <!-- Таб 1: Настройки политики -->
                    <TabItem Header="Настройки политики">
                        <DockPanel>

                            <!-- Заголовок -->
                            <TextBlock DockPanel.Dock="Top"
                           Text="{Binding SelectedPolicy.Name}"
                           Style="{StaticResource PanelHeaderStyle}" />

                            <TextBlock Text="{Binding SelectedPolicy.ExplainText}" TextWrapping="Wrap" Foreground="Gray" />

                            <!-- Редактор -->
                            <ContentControl>
                                <views:PolicyEditorControl
                        DataContext="{Binding PolicyEditorVM}" />
                            </ContentControl>

                        </DockPanel>
                    </TabItem>

                    <!-- Таб 2: Описание -->
                    <TabItem Header="Описание">
                        <ScrollViewer Margin="8"
                          VerticalScrollBarVisibility="Auto">
                            <TextBlock
                    Text="{Binding SelectedPolicy.Description}"
                    TextWrapping="Wrap"
                    Foreground="Gray" />
                        </ScrollViewer>
                    </TabItem>

                </TabControl>
            </Border>


        </Grid>

    </DockPanel>
</Window>
